---
- name: Add proxy variables to /etc/apache2/envvars to set Proxy for Apache2.
  lineinfile:
   path: /etc/apache2/envvars
   state: present
   line: "{{ item.line }}"
   regexp: "{{ item.regexp }}"
   create: no
  with_items:
    - line: "export http_proxy='http://{{ common_proxy_server }}:{{ common_proxy_port }}'"
      regexp: "^export http_proxy=.*"
    - line: "export https_proxy='http://{{ common_proxy_server }}:{{ common_proxy_port }}'"
      regexp: "^export https_proxy=.*"
    - line: "export no_proxy='localhost{% for proxy_exception in common_proxy_exceptions %}, {{ proxy_exception }}{% endfor %}'"
      regexp: "^export no_proxy=.*"
    - line: "export HTTP_PROXY='http://{{ common_proxy_server }}:{{ common_proxy_port }}'"
      regexp: "^export HTTP_PROXY=.*"
    - line: "export HTTPS_PROXY='http://{{ common_proxy_server }}:{{ common_proxy_port }}'"
      regexp: "^export HTTPS_PROXY=.*"
    - line: "export NO_PROXY='localhost{% for proxy_exception in common_proxy_exceptions %}, {{ proxy_exception }}{% endfor %}'"
      regexp: "^export NO_PROXY=.*"